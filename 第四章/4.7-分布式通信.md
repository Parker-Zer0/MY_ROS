## ROS分布式通信

> 针对教学视频的P176-P180

### **注意**：切换到桥接模式之后会发现虚拟机无法连接网络，这属于正常现象。

暂时还没找到解决办法。。。

## P176固定IP设置

ROS是一个分布式计算环境。一个运行中的ROS系统可以包含分布在多台计算机上多个节点。根据系统的配置方式，任何节点可能随时需要与任何其他节点进行通信。

因此，ROS对网络配置有某些要求：

-   所有端口上的所有机器之间必须有完整的双向连接。

-   每台计算机必须通过所有其他计算机都可以解析的名称来公告自己。

### 1.关闭虚拟机

### 2.打开虚拟机设置-网络，更改网络连接方式为桥接网卡

​	先要保证不同计算机处于同一网络中，最好分别设置固定IP，如果为虚拟机，需要将网络适配器改为桥接模式；

![image-20220921104152819](E:\Texts\For_Git\MY_ROS\第四章\assets\image-20220921104152819.png)

### 3.重新打开虚拟机，点击右上角，点击有线设置

![image-20220921104508581](E:\Texts\For_Git\MY_ROS\第四章\assets\image-20220921104508581.png)

### 4.进到如下界面后，点击`打开`开关右侧的齿轮

![image-20220921110539110](E:\Texts\For_Git\MY_ROS\第四章\assets\image-20220921110539110.png)

### 5.打开终端

 获取自己的有关网络的配置信息

```
ifconfig
```

> 大部分人会和我一样，会出现没有此命令选项，按照系统提示，执行`sudo apt install net-tools`指令安装即可

![image-20220921105319724](E:\Texts\For_Git\MY_ROS\第四章\assets\image-20220921105319724.png)

> 如果和视频教程一样出现**设备锁**的提示信息的话，因为我没有遇到，所以暂时提供不了解决方案

### 6.更改网络配置

重新/成功 执行

```
ifconfig
```

之后，会出现虚拟机网络的相关信息，下面是我的

![image-20220921111320859](E:\Texts\For_Git\MY_ROS\第四章\assets\image-20220921111320859.png)

按照红色线依次填入，网关直接输入192.168.19.1,选择应用即可

## P177hosts文件配置I

首先打开**主虚拟机**，输入

```
cd /etc
```

```
sudo gedit hosts
```

打开hosts文件，可以看到这样的页面

![image-20220921112713250](E:\Texts\For_Git\MY_ROS\第四章\assets\image-20220921112713250.png)

将上一步中**地址**的那串数字输入到第三行（上面部分的最后一行）

再在**副虚拟机**这边输入`hostname`，按照下面的这种方式写好即可

![image-20220921113551521](E:\Texts\For_Git\MY_ROS\第四章\assets\image-20220921113551521.png)

> 后面将主虚拟机和副虚拟机进行调换，执行一样的步骤即可

主机端:

```
从机的IP    从机计算机名
```

从机端:

```
主机的IP    主机计算机名
```



> 出现下面的内容

![image-20220921113644247](E:\Texts\For_Git\MY_ROS\第四章\assets\image-20220921113644247.png)

将两个虚拟机都进行重启即可完成当前一集的内容

## P178hosts文件配置II

首先对上一集的结果做一下网络连接测试，此时要保证两边的虚拟机均处于打开状态

```
ping "另一台的IP"
```

> 我这里写的IP是
>
> 主：192.168.31.90
> 副：192.168.31.198
>
> 我在主**虚拟机**这边就打上`ping 192.168.31.198`即可

> 如果可以看到类似下面的界面就表明配置成功

![image-20220922184901774](E:\Texts\For_Git\MY_ROS\第四章\assets\image-20220922184901774.png)

同样，ping+host名称也是可以的

## P179bashrc文件配置

##### 1.配置主机IP

配置主机的 IP 地址

~/.bashrc 追加

> `ctrl+H`可以查看隐藏文件

> 按照下面进行添加，我的放在了最后两行

```
export ROS_MASTER_URI=http://主机IP:11311
export ROS_HOSTNAME=主机IP
```

![image-20220922190735555](E:\Texts\For_Git\MY_ROS\第四章\assets\image-20220922190735555.png)

##### 2.配置从机IP

配置从机的 IP 地址，从机可以有多台，每台都做如下设置:

~/.bashrc 追加

```
export ROS_MASTER_URI=http://主机IP:11311
export ROS_HOSTNAME=从机IP
```

![img](E:\Texts\For_Git\MY_ROS\第四章\assets\C7NE6$JE`T`TOXKBY]SH1DN.png)

## P180**测试**

> 这里仍使用内置的小乌龟进行演示

1.主机启动 roscore(必须)

2.主机启动订阅节点，从机启动发布节点，测试通信是否正常

> 主机侧

![image-20220922191859045](E:\Texts\For_Git\MY_ROS\第四章\assets\image-20220922191859045.png)

> 副机侧

![img](E:\Texts\For_Git\MY_ROS\第四章\assets\K4EZ37H}0$J4N$J$U@KI9EF.jpg)

3.相同的，我们也可以进行反向测试，主机启动发布节点，从机启动订阅节点，测试通信是否正常

