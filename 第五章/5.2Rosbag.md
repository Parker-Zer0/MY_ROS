# Rosbag

> 此部分主要针对教学视频的P216~P221

## P216 Rosbag简介

机器人传感器获取到的信息，有时我们可能需要时时处理，有时可能只是采集数据，事后分析，比如:

> 机器人导航实现中，可能需要绘制导航所需的全局地图，地图绘制实现，有两种方式，方式1：可以控制机器人运动，将机器人传感器感知到的数据时时处理，生成地图信息。方式2：同样是控制机器人运动，将机器人传感器感知到的数据留存，事后，再重新读取数据，生成地图信息。两种方式比较，显然方式2使用上更为灵活方便。

在ROS中关于数据的留存以及读取实现，提供了专门的工具: rosbag。

___

### **概念**

是用于**录制和回放** ROS 主题的一个工具集。

### **作用**

实现了数据的复用，方便调试、测试。

### **本质**

rosbag本质也是ros的节点，当录制时，rosbag是一个订阅节点，可以订阅话题消息并将订阅到的数据写入磁盘文件；当重放时，rosbag是一个发布节点，可以读取磁盘文件，发布文件中的话题消息。

___

**另请参考:**

-   [http://wiki.ros.org/rosbag]

## P217 命令行的使用

> ROS 内置的乌龟案例并操作，操作过程中使用 rosbag 录制，录制结束后，实现重放

### 1.准备 

我们首先创建一个文件夹来专门保存录制的文件——`bags`

仍按照

```
roscore
rosrun turtlesim turtlesim_node 
rosrun turtlesim turtle_teleop_key
```

的顺序激活乌龟

### 2.开始录制

```
rosbag record -a -O 目标文件
```

其中，`record`表示录制，`-a`表示针对所有的话题消息，`-o`表示针对输出，目标文件的格式需要包括文件的名称+`.bag`。如rosbag record -a -o bags/hello.bag

操作小乌龟一段时间，结束录制使用 ctrl + c，在创建的目录中会生成bag文件。

![image-20220923193924214](E:\Texts\For_Git\MY_ROS\第五章\assets\image-20220923193924214.png)

### 3.查看文件

```
rosbag info 文件名
```

可以看到有如下信息

![image-20220923194336506](E:\Texts\For_Git\MY_ROS\第五章\assets\image-20220923194336506.png)

### 4.回放文件

```
rosbag play 文件名
```

重启乌龟节点，会发现，乌龟按照录制时的轨迹运动。

> 如果前三个命令保持不关闭，则会把播放前的状态作为起始点
>
> 也可以先关闭`turtlesim_node`重新打开，重新运行并播放就可以得到一样的运动轨迹

![image-20220923194652819](E:\Texts\For_Git\MY_ROS\第五章\assets\image-20220923194652819.png)

___

**另请参考:**

-   [http://wiki.ros.org/rosbag/Commandline]

## P218 使用C++录制rosbag文件

## P219 使用C++播放rosbag文件